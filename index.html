<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando Tienda...</title>
    <!-- Librer√≠as Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap">
    
    <style id="dynamic-styles">
        :root { --primary: #f97316; --text-main: #1e293b; }
        body { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; color: var(--text-main); background-color: #f8fafc; }
        .text-primary { color: var(--primary); }
        .bg-primary { background-color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .product-img-container { width: 100%; height: 200px; overflow: hidden; position: relative; }
        .product-img-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .modal-blur { backdrop-filter: blur(12px); }
        /* Animaci√≥n de carga */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- PANTALLA DE CARGA -->
    <div id="loader-view" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center">
        <div class="loader"></div>
        <p class="mt-4 text-slate-500 font-bold animate-pulse">Cargando cat√°logo...</p>
    </div>

    <div id="app" class="min-h-screen pb-20 hidden">
        <!-- HEADER -->
        <header class="bg-white/90 backdrop-blur-md sticky top-0 z-40 border-b border-slate-200 shadow-sm">
            <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <h1 id="brand-name" class="font-bold text-xl sm:text-2xl text-slate-900">Tienda</h1>
                </div>
                <!-- Bot√≥n Carrito -->
                <button onclick="toggleView('cart')" class="relative p-2 bg-slate-900 text-white rounded-xl shadow-md active:scale-95 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    <span id="cart-counter" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold border-2 border-white">0</span>
                </button>
            </div>
        </header>

        <!-- VISTA MEN√ö -->
        <main id="view-menu" class="max-w-5xl mx-auto p-4 animate-in fade-in duration-500">
            <!-- Descripci√≥n Tienda -->
            <p id="store-desc" class="text-sm text-slate-500 mb-4 px-1 italic"></p>
            
            <!-- Barra Categor√≠as -->
            <div id="category-bar" class="flex gap-2 overflow-x-auto no-scrollbar pb-6 sticky top-[65px] bg-transparent z-30"></div>
            
            <!-- Grid Productos -->
            <div id="product-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </main>

        <!-- VISTA CARRITO -->
        <section id="view-cart" class="hidden max-w-2xl mx-auto p-4 animate-in slide-in-from-right duration-300">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="toggleView('menu')" class="p-2 bg-white border border-slate-200 rounded-xl text-slate-500 hover:text-primary transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <h2 class="text-2xl font-bold text-slate-900">Tu Pedido</h2>
            </div>
            
            <div id="cart-list" class="space-y-3 mb-6"></div>

            <!-- Formulario Pedido -->
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-slate-100 space-y-4">
                <h3 class="font-bold text-sm uppercase text-slate-400 tracking-widest border-b pb-2">Datos de Entrega</h3>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="setDelivery('delivery')" id="btn-delivery" class="py-3 border-2 rounded-2xl font-bold text-sm transition-all">üè† Domicilio</button>
                    <button onclick="setDelivery('pickup')" id="btn-pickup" class="py-3 border-2 rounded-2xl font-bold text-sm transition-all">ü•° Recoger</button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="setPayment('cash')" id="btn-pay-cash" class="py-3 border-2 rounded-2xl font-bold text-sm transition-all">üíµ Efectivo</button>
                    <button onclick="setPayment('card')" id="btn-pay-card" class="py-3 border-2 rounded-2xl font-bold text-sm transition-all">üí≥ Tarjeta</button>
                </div>

                <input type="text" id="order-name" placeholder="Tu Nombre" class="w-full p-3 bg-slate-50 border rounded-xl outline-none focus:ring-2 focus:ring-primary/50">
                <input type="text" id="order-address" placeholder="Direcci√≥n completa" class="w-full p-3 bg-slate-50 border rounded-xl outline-none focus:ring-2 focus:ring-primary/50">
                <textarea id="order-notes" placeholder="Notas (alergias, timbre...)" class="w-full p-3 bg-slate-50 border rounded-xl outline-none h-20 resize-none"></textarea>

                <div class="border-t pt-4 flex justify-between items-end">
                    <span class="text-slate-400 font-bold">Total a Pagar</span>
                    <span id="cart-total" class="text-2xl font-black text-slate-900">0.00</span>
                </div>

                <button onclick="checkout()" class="w-full bg-green-500 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-green-200 hover:bg-green-600 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <span>Enviar Pedido por WhatsApp</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                </button>
            </div>
        </section>

        <!-- MODAL PRODUCTO -->
        <div id="product-modal" class="fixed inset-0 bg-slate-900/60 z-50 hidden modal-blur p-4 items-center justify-center">
            <div class="bg-white w-full max-w-lg rounded-[32px] overflow-hidden shadow-2xl animate-in slide-in-from-bottom duration-300 flex flex-col max-h-[90vh]">
                <div class="relative h-56 flex-shrink-0">
                    <img id="modal-img" src="" class="w-full h-full object-cover">
                    <button onclick="closeModal()" class="absolute top-4 right-4 bg-white/90 p-2 rounded-full shadow-sm hover:bg-white"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button>
                </div>
                <div class="p-6 overflow-y-auto flex-1">
                    <h3 id="modal-title" class="text-2xl font-bold text-slate-900 mb-2"></h3>
                    <p id="modal-desc" class="text-slate-500 text-sm mb-4"></p>
                    
                    <!-- VARIANTES (Tallas) -->
                    <div id="modal-variants-container" class="mb-4 hidden">
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2 tracking-widest">Elige una opci√≥n</label>
                        <div id="modal-variants-list" class="grid grid-cols-2 gap-2"></div>
                    </div>

                    <!-- EXTRAS -->
                    <div id="modal-extras-container" class="mb-4 hidden">
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2 tracking-widest">Extras</label>
                        <div id="modal-extras-list" class="space-y-2"></div>
                    </div>

                     <!-- REMOVALS (Sin) -->
                     <div id="modal-removals-container" class="mb-4 hidden">
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-2 tracking-widest">Quitar ingredientes (Gratis)</label>
                        <div id="modal-removals-list" class="space-y-2"></div>
                    </div>
                </div>
                <div class="p-4 bg-slate-50 border-t flex items-center justify-between gap-4">
                    <div class="flex items-center bg-white border rounded-xl overflow-hidden shadow-sm">
                        <button onclick="modQty(-1)" class="w-10 h-10 font-bold text-xl hover:bg-slate-100">-</button>
                        <span id="modal-qty" class="w-10 text-center font-bold">1</span>
                        <button onclick="modQty(1)" class="w-10 h-10 font-bold text-xl hover:bg-slate-100">+</button>
                    </div>
                    <button onclick="addToCart()" class="flex-1 bg-primary text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-transform flex justify-between px-6">
                        <span>A√±adir</span>
                        <span id="modal-price-btn">0.00</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        //  ‚¨áÔ∏è‚¨áÔ∏è PEGA AQU√ç EL ENLACE DE TU EXCEL ‚¨áÔ∏è‚¨áÔ∏è
        // ==========================================
        
        const CSV_LOCAL_FILE = "./datos_tienda.csv"; 

        // ==========================================

        function getSheetID(url) {
            if (!url || url === 'PON_AQUI_TU_ENLACE_DE_GOOGLE_SHEETS') return null;
            const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            return match ? match[1] : url; 
        }

        const SHEET_ID = getSheetID(GOOGLE_SHEET_LINK);

        let state = {
            config: { name: "Mi Tienda", desc: "", phone: "", prefix: "52", currency: "MXN", color: "#f97316" },
            categories: [],
            products: [],
            cart: [],
            deliveryType: 'delivery',
            paymentMethod: 'cash',
            activeCategory: null,
            modalProduct: null,
            modalQty: 1,
            selectedVariant: null
        };

        const formatPrice = (amount) => {
            return '$ ' + amount.toLocaleString('es-MX', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' ' + state.config.currency;
        };

        window.onload = async () => {
            if(!SHEET_ID) {
                alert("‚ö†Ô∏è ATENCI√ìN: Pega el enlace de tu Google Sheet en el archivo index.html.");
                document.getElementById('loader-view').innerHTML = '<div class="p-10 text-center"><h2 class="text-xl font-bold text-red-500">Falta Enlace</h2><p class="text-slate-500 mt-2">Edita el HTML y pega el enlace del Excel.</p></div>';
                return;
            }
            await fetchData();
        };

        async function fetchData() {
            // Se asume la primera hoja (gid=0 o por defecto) en formato CSV
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
            
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                processData(csvText);
                
                applyStyles();
                renderApp();
                document.getElementById('loader-view').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert("Error cargando datos. Verifica que el Excel est√© 'Publicado en la web' como CSV.");
            }
        }

        function processData(csv) {
            Papa.parse(csv, { 
                header: true, 
                skipEmptyLines: true, 
                complete: (res) => {
                    const data = res.data;
                    if(data.length === 0) return;

                    // 1. Extraer Configuraci√≥n (Solo de la primera fila)
                    const firstRow = data[0];
                    if(firstRow) {
                        state.config.name = firstRow['Tienda_Nombre'] || "Mi Tienda";
                        state.config.desc = firstRow['Tienda_Descripcion'] || "";
                        state.config.phone = firstRow['Tienda_Telefono'] || "";
                        state.config.prefix = firstRow['Tienda_Prefijo'] || "52";
                        state.config.currency = firstRow['Tienda_Moneda'] || "MXN";
                        state.config.color = firstRow['Tienda_Color_1'] || "#f97316";

                        document.title = state.config.name;
                        document.getElementById('brand-name').innerText = state.config.name;
                        document.getElementById('store-desc').innerText = state.config.desc;
                    }

                    // 2. Procesar Productos y Categor√≠as
                    let cats = new Set();
                    state.products = data.map(r => {
                        if(!r['Prod_Nombre']) return null; // Ignorar filas vac√≠as

                        cats.add(r['Prod_Categoria']);

                        const cleanPrice = (str) => parseFloat(str?.replace(/[^0-9.]/g, '')) || 0;
                        const parseList = (str) => str ? str.split(',').map(s => s.trim()).filter(s => s) : [];
                        
                        // Variantes: "Nombre:Precio"
                        const variants = parseList(r['Prod_Variantes']).map(v => {
                            const [n, p] = v.split(':');
                            return { name: n.trim(), price: cleanPrice(p) };
                        });

                        // Extras: "Nombre:Precio"
                        const extras = parseList(r['Prod_Extras']).map(e => {
                            const [n, p] = e.split(':');
                            return { name: n.trim(), price: cleanPrice(p) };
                        });

                        // Sin: "Ingrediente"
                        const removals = parseList(r['Prod_Sin']).map(s => ({ name: s }));

                        // Imagen
                        let img = r['Prod_Imagen'];
                        if (img && !img.startsWith('http')) {
                            img = 'images/' + img;
                        }

                        return {
                            id: Math.random().toString(36).substr(2, 9),
                            name: r['Prod_Nombre'],
                            desc: r['Prod_Descripcion'],
                            price: cleanPrice(r['Prod_Precio']),
                            category: r['Prod_Categoria'],
                            image: img,
                            variants,
                            extras,
                            removals
                        };
                    }).filter(p => p !== null);

                    state.categories = Array.from(cats);
                    if(state.categories.length) state.activeCategory = state.categories[0];
                }
            });
        }

        function applyStyles() { document.documentElement.style.setProperty('--primary', state.config.color); }
        function renderApp() { renderCategories(); renderProducts(); }

        function renderCategories() {
            document.getElementById('category-bar').innerHTML = state.categories.map(cat => `
                <button onclick="setCategory('${cat}')" class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all border ${state.activeCategory === cat ? 'bg-primary text-white border-transparent shadow-md' : 'bg-white text-slate-500 border-slate-200'}">${cat}</button>
            `).join('');
        }

        function renderProducts() {
            const container = document.getElementById('product-container');
            const filtered = state.products.filter(p => p.category === state.activeCategory);
            container.innerHTML = filtered.length ? filtered.map(p => {
                const displayPrice = p.variants.length > 0 ? Math.min(...p.variants.map(v=>v.price)) : p.price;
                const imgUrl = p.image || 'https://via.placeholder.com/400x300?text=Sin+Imagen';
                
                return `
                <div onclick="openProductModal('${p.id}')" class="bg-white rounded-3xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-xl transition-all cursor-pointer group">
                    <div class="product-img-container">
                        <img src="${imgUrl}" class="group-hover:scale-105" onerror="this.src='https://via.placeholder.com/400x300?text=Sin+Imagen'">
                    </div>
                    <div class="p-5">
                        <div class="flex flex-col mb-2">
                            <h3 class="font-bold text-lg text-slate-900 leading-tight mb-1">${p.name}</h3>
                            <span class="font-bold text-primary text-sm">${p.variants.length ? 'Desde ' : ''}${formatPrice(displayPrice)}</span>
                        </div>
                        <p class="text-xs text-slate-400 line-clamp-2">${p.desc || ''}</p>
                    </div>
                </div>`
            }).join('') : `<div class="col-span-full py-10 text-center text-slate-400">Sin productos.</div>`;
        }

        function setCategory(cat) { state.activeCategory = cat; renderCategories(); renderProducts(); }

        function openProductModal(id) {
            const p = state.products.find(x => x.id == id);
            if(!p) return;
            state.modalProduct = p;
            state.modalQty = 1;
            state.selectedVariant = p.variants.length > 0 ? p.variants[0] : null;

            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-desc').innerText = p.desc || '';
            const imgEl = document.getElementById('modal-img');
            imgEl.src = p.image || 'https://via.placeholder.com/400x300';
            imgEl.onerror = function() { this.src = 'https://via.placeholder.com/400x300?text=Sin+Imagen'; };
            
            const varContainer = document.getElementById('modal-variants-container');
            if(p.variants.length) {
                varContainer.classList.remove('hidden');
                document.getElementById('modal-variants-list').innerHTML = p.variants.map((v, idx) => `
                    <button onclick="selectVariant(${idx})" class="variant-btn p-3 border-2 rounded-xl text-xs font-bold text-center transition-all ${idx===0 ? 'border-primary bg-primary/10 text-primary' : 'border-slate-100 text-slate-500 hover:border-slate-200'}">
                        ${v.name}<br><span class="text-[10px] opacity-80">${formatPrice(v.price)}</span>
                    </button>
                `).join('');
            } else { varContainer.classList.add('hidden'); }

            const extraContainer = document.getElementById('modal-extras-container');
            if(p.extras.length) {
                extraContainer.classList.remove('hidden');
                document.getElementById('modal-extras-list').innerHTML = p.extras.map((e, idx) => `
                    <label class="flex items-center justify-between p-3 bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-primary/30 transition-colors">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" class="extra-chk w-4 h-4 text-primary rounded border-slate-300 focus:ring-primary" value="${idx}" onchange="updateModalPrice()">
                            <span class="text-sm font-medium text-slate-700">${e.name}</span>
                        </div>
                        <span class="text-xs font-bold text-primary">+${formatPrice(e.price)}</span>
                    </label>`).join('');
            } else { extraContainer.classList.add('hidden'); }

            const remContainer = document.getElementById('modal-removals-container');
            if(p.removals.length) {
                remContainer.classList.remove('hidden');
                document.getElementById('modal-removals-list').innerHTML = p.removals.map((r, idx) => `
                    <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer border border-transparent hover:border-red-200 transition-colors">
                        <input type="checkbox" class="rem-chk w-4 h-4 text-red-500 rounded border-slate-300 focus:ring-red-500" value="${idx}">
                        <span class="text-sm font-medium text-slate-700">Sin ${r.name}</span>
                    </label>`).join('');
            } else { remContainer.classList.add('hidden'); }

            document.getElementById('product-modal').classList.remove('hidden');
            document.getElementById('product-modal').classList.add('flex');
            updateModalPrice();
        }

        function selectVariant(idx) {
            state.selectedVariant = state.modalProduct.variants[idx];
            document.querySelectorAll('.variant-btn').forEach((btn, i) => {
                if(i === idx) { btn.className = "variant-btn p-3 border-2 rounded-xl text-xs font-bold text-center transition-all border-primary bg-primary/10 text-primary"; }
                else { btn.className = "variant-btn p-3 border-2 rounded-xl text-xs font-bold text-center transition-all border-slate-100 text-slate-500 hover:border-slate-200"; }
            });
            updateModalPrice();
        }

        function closeModal() { document.getElementById('product-modal').classList.add('hidden'); document.getElementById('product-modal').classList.remove('flex'); }
        function modQty(v) { state.modalQty = Math.max(1, state.modalQty + v); document.getElementById('modal-qty').innerText = state.modalQty; updateModalPrice(); }

        function updateModalPrice() {
            let base = state.selectedVariant ? state.selectedVariant.price : state.modalProduct.price;
            document.querySelectorAll('.extra-chk:checked').forEach(chk => base += state.modalProduct.extras[chk.value].price);
            document.getElementById('modal-price-btn').innerText = formatPrice(base * state.modalQty);
        }

        function addToCart() {
            let extras = [];
            let removals = [];
            let extraTotal = 0;

            document.querySelectorAll('.extra-chk:checked').forEach(chk => {
                const e = state.modalProduct.extras[chk.value];
                extras.push(e); extraTotal += e.price;
            });
            document.querySelectorAll('.rem-chk:checked').forEach(chk => {
                removals.push(state.modalProduct.removals[chk.value]);
            });

            const basePrice = state.selectedVariant ? state.selectedVariant.price : state.modalProduct.price;
            
            state.cart.push({
                cartId: Date.now(),
                id: state.modalProduct.id,
                name: state.modalProduct.name,
                variantName: state.selectedVariant ? state.selectedVariant.name : null,
                unitPrice: basePrice + extraTotal,
                qty: state.modalQty,
                extras, removals
            });

            updateCartCounter(); closeModal();
        }

        function updateCartCounter() {
            document.getElementById('cart-counter').innerText = state.cart.reduce((a, b) => a + b.qty, 0);
            renderCartList();
        }

        function renderCartList() {
            const list = document.getElementById('cart-list');
            let total = 0;
            if(!state.cart.length) { list.innerHTML = `<div class="text-center py-10 text-slate-400 italic">Tu carrito est√° vac√≠o.</div>`; }
            else {
                list.innerHTML = state.cart.map(item => {
                    const subtotal = item.unitPrice * item.qty;
                    total += subtotal;
                    return `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center relative overflow-hidden">
                        <div>
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-slate-900">${item.qty}x</span>
                                <span class="font-bold text-slate-800">${item.name}</span>
                            </div>
                            ${item.variantName ? `<p class="text-[10px] font-bold text-slate-500 uppercase tracking-wide bg-slate-100 inline-block px-1 rounded mt-1">${item.variantName}</p>` : ''}
                            ${item.extras.length ? `<p class="text-xs text-blue-500 mt-1">‚ûï ${item.extras.map(e=>e.name).join(', ')}</p>` : ''}
                            ${item.removals.length ? `<p class="text-xs text-red-400 mt-0.5">üö´ Sin: ${item.removals.map(r=>r.name).join(', ')}</p>` : ''}
                            <p class="text-sm font-bold text-primary mt-1">${formatPrice(subtotal)}</p>
                        </div>
                        <button onclick="state.cart = state.cart.filter(i => i.cartId !== ${item.cartId}); updateCartCounter();" class="text-slate-300 hover:text-red-500 p-2 text-xl font-bold">√ó</button>
                    </div>`;
                }).join('');
            }
            document.getElementById('cart-total').innerText = formatPrice(total);
        }

        function toggleView(v) {
            document.getElementById('view-menu').classList.toggle('hidden', v !== 'menu');
            document.getElementById('view-cart').classList.toggle('hidden', v !== 'cart');
            if(v === 'cart') renderCartList();
        }

        function setDelivery(t) {
            state.deliveryType = t;
            document.getElementById('btn-delivery').className = `py-3 border-2 rounded-2xl font-bold text-sm transition-all ${t==='delivery' ? 'bg-primary border-primary text-white shadow-md' : 'bg-white border-slate-200 text-slate-400'}`;
            document.getElementById('btn-pickup').className = `py-3 border-2 rounded-2xl font-bold text-sm transition-all ${t==='pickup' ? 'bg-primary border-primary text-white shadow-md' : 'bg-white border-slate-200 text-slate-400'}`;
            document.getElementById('order-address').style.display = t === 'pickup' ? 'none' : 'block';
        }

        function setPayment(t) {
            state.paymentMethod = t;
            document.getElementById('btn-pay-cash').className = `py-3 border-2 rounded-2xl font-bold text-sm transition-all ${t==='cash' ? 'bg-primary border-primary text-white shadow-md' : 'bg-white border-slate-200 text-slate-400'}`;
            document.getElementById('btn-pay-card').className = `py-3 border-2 rounded-2xl font-bold text-sm transition-all ${t==='card' ? 'bg-primary border-primary text-white shadow-md' : 'bg-white border-slate-200 text-slate-400'}`;
        }

        function checkout() {
            if(!state.cart.length) return alert("Tu carrito est√° vac√≠o.");
            const name = document.getElementById('order-name').value.trim();
            const address = document.getElementById('order-address').value.trim();
            const notes = document.getElementById('order-notes').value.trim();
            
            if(!name) return alert("Por favor escribe tu nombre.");
            if(state.deliveryType === 'delivery' && !address) return alert("Por favor escribe tu direcci√≥n.");

            let msg = `üëã *PEDIDO DE ${name.toUpperCase()}*\n================\n`;
            msg += `üõµ *Tipo:* ${state.deliveryType==='delivery'?'Domicilio':'Recogida'}\n`;
            if(state.deliveryType === 'delivery') msg += `üìç *Dir:* ${address}\n`;
            msg += `üí≥ *Pago:* ${state.paymentMethod==='cash'?'Efectivo':'Tarjeta'}\n\n`;
            
            state.cart.forEach(i => {
                msg += `‚ñ™Ô∏è ${i.qty}x *${i.name}* ${i.variantName ? `(${i.variantName})` : ''}\n`;
                if(i.extras.length) msg += `   ‚ûï ${i.extras.map(e=>e.name).join(', ')}\n`;
                if(i.removals.length) msg += `   üö´ Sin: ${i.removals.map(r=>r.name).join(', ')}\n`;
            });
            msg += `\nüí∞ *TOTAL: ${document.getElementById('cart-total').innerText}*\n`;
            if(notes) msg += `üìù *Nota:* ${notes}`;

            const phone = state.config.prefix + state.config.phone;
            window.open(`https://wa.me/${phone.replace(/\+/g,'')}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>

</html>
